---
title: "Stability concerns in random matrices"
author: "Brad Duthie"
bibliography: references.bib
output:
  html_document: default
  pdf_document:
    fig_caption: yes
  word_document:
    fig_caption: yes
    pandoc_args:
    - --csl
    - evolution.csl
    reference_docx: docx_template.docx
header-includes:
- \usepackage{amsmath}
- \usepackage{natbib}
- \usepackage{lineno}
- \usepackage[utf8]{inputenc}
- \linenumbers
- \bibliographystyle{amnatnat}
linestretch: 1
link-citations: yes
linkcolor: blue
csl: evolution.csl
biblio-style: apalike
---

********************************************************************************

**UPDATE 8 APR**:

Here's a working outline of the manuscript:

1. Introductory [summary paragraph](http://s3-service-broker-live-19ea8b98-4d41-4cb4-be4c-d68f4963b7dd.s3.amazonaws.com/uploads/ckeditor/attachments/7808/2c_Summary_para.pdf), which will be broadly focused on complex system stability.
2. Go back to @May1972 and note how the original ecological result has been broadened for systems such as evolutionary networks, gene regulatory networks, economics, etc. (references needed). Perhaps make the broader point that even local systems have different elements of different types of systems. 
3. Briefly point out the advances that have been made in terms of network structures (e.g., random versus competitive interactions), but then hit the point that different components of complex systems are expected to respond on different time scales [e.g. @Patel2018], and no one has looked at how this might affect stability of systems more broadly. The current paper is going to show that variation in component response rate increases stability.
4. A paragraph with some broad explanation of the idea of matrix stability, along the lines of @Allesina2012. This will effectively explain the idea of random matrix theory to the reader.
5. A paragraph introducing, mathematically, how I am adding varying rates of component response -- multipling each row $i$ by a scalar $\gamma_{i}$. First this will be done with some simple function giving $Var(\gamma_{i})$, then in a more structured way such that random components that are more likely to be positively influenced by other components having faster or slower rates (higher or lower $\gamma_{i}$) of response. A sentence or two is needed to suggest what this might mean biologically (e.g., generalist predators have longer generation times than their prey). 
6. A paragraph explaining the results of the random matrices, with brief mention of other types of systems (e.g., predator-prey, mutualist, competitor) presented in supporting information. The obvious increase in stability with different variation of $\gamma_{i}$ will be presented, along with an intuitive explanation of why this is the case (still waiting on simulations -- it would be great if correlation between positive or negative processes and response times led to increased stability, as appears to be the case. I could then argue that $Var(\gamma_{i})$ has a minimum such correlation of zero, and can only increase in stabilisation by having an absolute value of correlation being greater than zero). At least two [key figures](#fig_ideas) will be included, likely with four panels (1. without variation, 2. with unstructured variation, and 3. and 4. with structured variation).
7. Some sort of mention is needed for a couple odd results; first, that in mutualist networks, stability is not affected -- perhaps because of the lack of variance in component response rate given number of interaction types (note, I think, competitive networks can have indirect positives due to intransitive effects). Second, *feasibility* is not increased, so pure ecological networks might not be affected by this (but emphasise that *pure* ecological networks don't really exist in nature -- they are incorporated into evolutionary, economic, social, systems).
8. Some bold statement is needed here -- something to the effect of the argument that nearly all large stable complex systems will be stable *due to* the variation simulated in this paper. The odds that it would be stable without such variation becomes vanishingly small as system size increases.



**UPDATE 7 APR**:

Currently, I am having 1 million simulations run for four community types (random, competitor, mutualist, predator-prey). But the manuscript itself is likely to focus genearally on **stability of complex systems as a consequence of variation in the response rate of individual components** (that will not be the title). It will be in the form of a [general 1500 word letter](https://www.nature.com/nature/for-authors/formatting-guide#a1), with an appropriate [introductory summary paragraph](http://s3-service-broker-live-19ea8b98-4d41-4cb4-be4c-d68f4963b7dd.s3.amazonaws.com/uploads/ckeditor/attachments/7808/2c_Summary_para.pdf). At least two key results will be emphasised:

1. **System stability increases with variation in component response rate. And stable large complex systems are almost certain to be dependent upon this variation for preserving their stability** As sub-points, this is generally true for random, competitor, and predator-prey, but not mutualist systems. Further, feasibility is not increased by this variation, but it can be argued that no ecological system is isolated from other processes (evolutionary, social, economic). The importance of the bold result needs to be emphasised while also acknowledging the nuance, and further acknowledging that *most* stable systems will be actually *destabilised* by variation in component response rate. Paradoxically, initial analysis appears to reveal that *addition* of such variation is more likely to destabilise already stable complex systems than it is to stabilise existing unstable complex systems. But overall, **complex systems with variation in component response rate are more likely to be stable than systems with no such variation**. The logic behind this needs to be made clear.
2. **System stability increases when component response rate is correlated with component interaction type**. For example, if components that typically respond positively to increases in other components (e.g., a generalist top level predator in a community) tend to move respond more or less quickly than other types of components, the whole system is highly likely to be stabilised (more so than just given general variance as discussed in 1 above). Simulations for this are still running, but if this is even more stabilising, then it would be worth including in the manuscript.

Other key results will come if I can think of other interesting ways to vary component response rate.

<a name="fig_ideas">Key figures</a> of this paper will include:

1. Before and after side-by-side histograms of system stability proportion (or count), with overlayed line showing the percentage of systems that are stable *due to* variation in component time.
2. A heat map of eigenvalues before and after variation over many simulations.

The manuscript overall is going to need to be very general, not just ecology focused. I will need to talk about complex systems such as evolutionary systems, social systems, and financial systems (the last one here is a very clear case where negative values are allowed, so feasibility is not as big of a deal). 

Relevant papers [here](https://www.nature.com/articles/nature16948), and [here](http://science.sciencemag.org/content/337/6092/349)? I also need to add some code to skip feasibility analyses when matrices have determinant of zero (are singular), as part of the feasibility analysis requires matrix inversion.

**UPDATE 30 MAR**: 

It appears that one of the assumptions that I was making was rather badly thought out. In checking for feasibility, I simulated random intrinsic species growth rates that were sampled from a uniform distribution $\mathcal{U}\left(0, 1\right)$. I thought this would be reasonable at first because species intrinsic population growth rates surely would need to be positive for a species to avoid extinction; this of course is not the case. A simple counter-example is that of an obligate mutualist. In the absence of a mutualist partner, the obligate mutualist *by definition* should have a negative intrinsic growth rate. Hence, the more appropriate sampling for elements of the vector $\textbf{r}$ should be something like $\mathcal{U}\left(-1, 1\right)$. When doing it this way, variation in generation time appears to have no effect, rather than a negative effect, on feasibility. More simulations of this are needed to confirm. To answer the obvious question, sampling from something like $\mathcal{U}\left(-1, 0\right)$ to get elements for $\textbf{r}$ *does not* appear to increase feasibility at first glance, but I'm simulating more communities to double-check.

**Note**: @Song2018, rehashing @May1972, point out that "stable communities will only emerge as long as a derived measure of com- munity complexity is below a certain threshold" defined by $\sigma\sqrt{S \times C}$, "where $\sigma$ represents the standard deviation of the distribution of interaction strengths, S corresponds to the number of species in the community, and C corresponds to the connectance in the community". I believe that $Var(\gamma_{i})$ would be independent of all of these parameters (not modifying the *strength* of interactions or the *connectance*, but the speed of system components). 

Nevertheless, @Song2018 state that as long as $\sigma\sqrt{S \times C} < 1$, the system will be stable regardless of other parameters in the system. I believe that the simulations with $Var(\gamma_{i})$ now show otherwise, but I need to make sure. In the simulations that I have run $S \times C = S$ because $C = 1$ (I've not tried anything else). Is the standard deviation of interaction strengths changing as a consequence of $\sqrt{Var(\gamma_{i})}$? 


**NEW AUTHORS NOTE:** After analysing the new results, I am thinking that a different angle is needed for a strong publication. To recap what has happened:

- I started analysing random communities of simulated species using matrices and a mathematical trick similar to that used in @Patel2018 in attempt to see if variation in generation time among species will stabilise or destabilise large communities.
- I initially found variation in generation time to be highly stabilising, and, in particular, as species richness increased, the overwhelming number of stable random communties were stable *due to variation in generation time* (and would otherwise be unstable). Results are summarised in [this figure](#old_fig_1) and [this table](#old_tab_1).
- I then read the very recent paper by @Dougoud2018, who showed that the classic stability criteria used by @May1972 and @Allesina2012 (among others) have been flawed. Some "stable" communities in these studies are stable (i.e., return to equilibrium values if perturbed) at *negative* species densities. @Dougoud2018 demonstrate how to check whether or not random communities are "feasible", meaning that they are stable and have species densities that are all positive (and hence, sensible ecological communities).
- I applied the criteria of @Dougoud2018 to my random communities under the same parameter values that they and others have used; I also looked at communities characterised only by competitive, mutualistic, and predator-prey interactions.
- Strangely, variation in generation time has the exact *opposite* effect in random, competitive, and predator-prey communities; variation in generation time therefore *increases* stability but *decreases* feasibility (i.e., variation in generation time shifts communities toward being "stable" with negative species densities and away from being "stable" with positive species densities). The overall effect is therefore to make real ecological communities less stable.
- I am still working out what this means conceptually (trying to do this by plotting the eigenvalues and comparing different random systems).
- The exception to all of this is mutualistic communities -- variation in generation time had zero effect on mutualist community stability.
- **I am tempted to broaden these results to make a more general point about complex dynamic systems**: "Variation in process time increases stability but decreases feasibility in complex systems", with a focus on biological systems. There might be some types of systems where negative values are actually meaningful (e.g., phenotypes in evolving systems, gene regulatory networks? Suggestions very welcome), just not in ecological ones where species densities obviously cannot be negative.

The plot below shows the story for the effect of variation in generation time on stability and feasibility.

```{r, echo = FALSE, fig.height = 10, fig.width = 10}
random      <- read.csv(file = "sim_results_old/random_community.csv");
competition <- read.csv(file = "sim_results_old/competitor_community.csv");
mutualism   <- read.csv(file = "sim_results_old/mutualist_community.csv");
pred_prey   <- read.csv(file = "sim_results_old/predator_prey_community.csv");
# ==============================================================================
par(mfrow = c(2, 2));
# ==============================================================================
dat      <- random;
Sp       <- dat[,1];
stab_nov <- dat[,3] + dat[,4];
stab_var <- dat[,3] + dat[,5];
feas_nov <- dat[,7] + dat[,8];
feas_var <- dat[,7] + dat[,9];
plot(x = Sp, y = stab_nov / 100000, type = "l", lwd = 2, ylim = c(0,1),
     cex.lab = 1.5, cex.axis = 1.5, xlab = "Species Number (S)",
     ylab = "Proportion stable or feasible");
points(x = Sp, y = stab_var / 100000, type = "l", lwd = 2, lty = "dashed");
points(x = Sp, y = feas_nov / 100000, type = "l", lwd = 2, col = "red");
points(x = Sp, y = feas_var / 100000, type = "l", lwd = 2, col = "red",
       lty = "dashed");
legend(x = 40, y = 0.9, col = c("black", "black", "red", "red"), cex = 1.2,
       legend = c(expression(paste("Stable, no Var(",gamma,")")),
                             expression(paste("Stable, Var(",gamma,")")),
                             expression(paste("Feasible, no Var(",gamma,")")),
                             expression(paste("Feasible, Var(",gamma,")"))),
       lty = c("solid", "dashed", "solid", "dashed"), lwd = 2);
text(x = 60, y = 0.98, labels = "Random", cex = 2);
# ==============================================================================
dat      <- competition;
stab_nov <- dat[,3] + dat[,4];
stab_var <- dat[,3] + dat[,5];
feas_nov <- dat[,7] + dat[,8];
feas_var <- dat[,7] + dat[,9];
plot(x = Sp, y = stab_nov / 100000, type = "l", lwd = 2, ylim = c(0,1),
     cex.lab = 1.5, cex.axis = 1.5, xlab = "Species Number (S)",
     ylab = "Proportion stable or feasible");
points(x = Sp, y = stab_var / 100000, type = "l", lwd = 2, lty = "dashed");
points(x = Sp, y = feas_nov / 100000, type = "l", lwd = 2, col = "red");
points(x = Sp, y = feas_var / 100000, type = "l", lwd = 2, col = "red",
       lty = "dashed");
text(x = 60, y = 0.98, labels = "Competitive", cex = 2);
# ==============================================================================
dat      <- mutualism;
stab_nov <- dat[,3] + dat[,4];
stab_var <- dat[,3] + dat[,5];
feas_nov <- dat[,7] + dat[,8];
feas_var <- dat[,7] + dat[,9];
plot(x = Sp, y = stab_nov / 100000, type = "l", lwd = 2, ylim = c(0,1),
     cex.lab = 1.5, cex.axis = 1.5, xlab = "Species Number (S)",
     ylab = "Proportion stable or feasible");
points(x = Sp, y = stab_var / 100000, type = "l", lwd = 2, lty = "dashed");
points(x = Sp, y = feas_nov / 100000, type = "l", lwd = 2, col = "red");
points(x = Sp, y = feas_var / 100000, type = "l", lwd = 2, col = "red",
       lty = "dashed");
text(x = 60, y = 0.98, labels = "Mutualist", cex = 2);
# ==============================================================================
dat      <- pred_prey;
stab_nov <- dat[,3] + dat[,4];
stab_var <- dat[,3] + dat[,5];
feas_nov <- dat[,7] + dat[,8];
feas_var <- dat[,7] + dat[,9];
plot(x = Sp, y = stab_nov / 100000, type = "l", lwd = 2, ylim = c(0,1),
     cex.lab = 1.5, cex.axis = 1.5, xlab = "Species Number (S)",
     ylab = "Proportion stable or feasible");
points(x = Sp, y = stab_var / 100000, type = "l", lwd = 2, lty = "dashed");
points(x = Sp, y = feas_nov / 100000, type = "l", lwd = 2, col = "red");
points(x = Sp, y = feas_var / 100000, type = "l", lwd = 2, col = "red",
       lty = "dashed");
text(x = 60, y = 0.98, labels = "Predator-prey", cex = 2);
# ==============================================================================
```

And here's the same plot with the axes shifted a bit.

```{r, echo = FALSE, fig.height = 10, fig.width = 10}
random      <- read.csv(file = "sim_results_old/random_community.csv");
competition <- read.csv(file = "sim_results_old/competitor_community.csv");
mutualism   <- read.csv(file = "sim_results_old/mutualist_community.csv");
pred_prey   <- read.csv(file = "sim_results_old/predator_prey_community.csv");
# ==============================================================================
par(mfrow = c(2, 2));
# ==============================================================================
dat      <- random;
Sp       <- dat[,1];
stab_nov <- dat[,3] + dat[,4];
stab_var <- dat[,3] + dat[,5];
feas_nov <- dat[,7] + dat[,8];
feas_var <- dat[,7] + dat[,9];
plot(x = Sp, y = stab_nov / 100000, type = "l", lwd = 2, ylim = c(0,1),
     cex.lab = 1.5, cex.axis = 1.5, xlab = "Species Number (S)",
     ylab = "Proportion stable or feasible", xlim = c(0, 30));
points(x = Sp, y = stab_var / 100000, type = "l", lwd = 2, lty = "dashed");
points(x = Sp, y = feas_nov / 100000, type = "l", lwd = 2, col = "red");
points(x = Sp, y = feas_var / 100000, type = "l", lwd = 2, col = "red",
       lty = "dashed");
legend(x = 12, y = 0.9, col = c("black", "black", "red", "red"), cex = 1.2,
       legend = c(expression(paste("Stable, no Var(",gamma,")")),
                             expression(paste("Stable, Var(",gamma,")")),
                             expression(paste("Feasible, no Var(",gamma,")")),
                             expression(paste("Feasible, Var(",gamma,")"))),
       lty = c("solid", "dashed", "solid", "dashed"), lwd = 2);
text(x = 17, y = 0.98, labels = "Random", cex = 2);
# ==============================================================================
dat      <- competition;
stab_nov <- dat[,3] + dat[,4];
stab_var <- dat[,3] + dat[,5];
feas_nov <- dat[,7] + dat[,8];
feas_var <- dat[,7] + dat[,9];
plot(x = Sp, y = stab_nov / 100000, type = "l", lwd = 2, ylim = c(0,1),
     cex.lab = 1.5, cex.axis = 1.5, xlab = "Species Number (S)",
     ylab = "Proportion stable or feasible", xlim = c(0, 30));
points(x = Sp, y = stab_var / 100000, type = "l", lwd = 2, lty = "dashed");
points(x = Sp, y = feas_nov / 100000, type = "l", lwd = 2, col = "red");
points(x = Sp, y = feas_var / 100000, type = "l", lwd = 2, col = "red",
       lty = "dashed");
text(x = 15, y = 0.98, labels = "Competitive", cex = 2);
# ==============================================================================
dat      <- mutualism;
stab_nov <- dat[,3] + dat[,4];
stab_var <- dat[,3] + dat[,5];
feas_nov <- dat[,7] + dat[,8];
feas_var <- dat[,7] + dat[,9];
plot(x = Sp, y = stab_nov / 100000, type = "l", lwd = 2, ylim = c(0,1),
     cex.lab = 1.5, cex.axis = 1.5, xlab = "Species Number (S)",
     ylab = "Proportion stable or feasible", xlim = c(0, 10));
points(x = Sp, y = stab_var / 100000, type = "l", lwd = 2, lty = "dashed");
points(x = Sp, y = feas_nov / 100000, type = "l", lwd = 2, col = "red");
points(x = Sp, y = feas_var / 100000, type = "l", lwd = 2, col = "red",
       lty = "dashed");
text(x = 6, y = 0.98, labels = "Mutualist", cex = 2);
# ==============================================================================
dat      <- pred_prey;
stab_nov <- dat[,3] + dat[,4];
stab_var <- dat[,3] + dat[,5];
feas_nov <- dat[,7] + dat[,8];
feas_var <- dat[,7] + dat[,9];
plot(x = Sp, y = stab_nov / 100000, type = "l", lwd = 2, ylim = c(0,1),
     cex.lab = 1.5, cex.axis = 1.5, xlab = "Species Number (S)",
     ylab = "Proportion stable or feasible");
points(x = Sp, y = stab_var / 100000, type = "l", lwd = 2, lty = "dashed");
points(x = Sp, y = feas_nov / 100000, type = "l", lwd = 2, col = "red");
points(x = Sp, y = feas_var / 100000, type = "l", lwd = 2, col = "red",
       lty = "dashed");
text(x = 60, y = 0.98, labels = "Predator-prey", cex = 2);
# ==============================================================================
```

We can delve a bit deeper into this mess by looking at the distribution of eigenvalues in sample communities that are unstable, stable, destabilised, or stabilised. The plot below shows these examples for communities where species number $S = 20$. This gives the same type of plots as shown in @Allesina2012. Black points show eigenvalues before variation in generation time is added, and red points show eigenvalues after variation in generation time is added. The shift is not typically drastic, but sometimes causes the sign of the real components (x-axis) to flip, thereby potentially affecting stability. Immediately below shows plots for a random community; where no points are plotted in any of the figures below, no examples exist.

```{r, echo = FALSE}
rand_gen_var <- function(max_sp, iters, int_type = 0, rmx = 10, eps_max = 999){
    tot_res <- NULL;
    fea_res <- NULL;
    for(i in 2:max_sp){
        nn             <- i;
        A1_stt         <- 0;
        A2_stt         <- 0;
        A1_fet         <- 0;
        A2_fet         <- 0;
        iter           <- iters;
        tot_res[[i-1]] <- matrix(data = 0, nrow = iter, ncol = 2);
        fea_res[[i-1]] <- matrix(data = 0, nrow = iter, ncol = 2);
        while(iter > 0){
            r_vec    <- runif(n = nn, min = 1, max = rmx);
            A1_dat   <- rnorm(n = nn * nn, mean = 0, sd = 0.4);
            A1       <- matrix(data = A1_dat, nrow = nn, ncol = nn);
            A1       <- species_interactions(mat = A1, type = int_type);
            diag(A1) <- -1;
            epsil    <- runif(n = nn, min = 1, max = eps_max);
            eps_dat  <- rep(x = epsil, times = nn);
            eps_mat  <- matrix(data = epsil, nrow = nn, ncol = nn, 
                               byrow = FALSE);
            avg_mat  <- matrix(data = mean(1:eps_max), nrow = nn, ncol = nn, 
                               byrow = FALSE);
            A2       <- A1 * eps_mat;
            A1       <- A1 * avg_mat;
            A1_stb   <- max(Re(eigen(A1)$values)) < 0;
            A2_stb   <- max(Re(eigen(A2)$values)) < 0;
            A1_fea   <- min(-1*solve(A1) %*% r_vec) > 0;
            A2_fea   <- min(-1*solve(A2) %*% r_vec) > 0;
            if(A1_stb == TRUE){
                tot_res[[i-1]][iter, 1] <- 1;
            }
            if(A2_stb == TRUE){
                tot_res[[i-1]][iter, 2] <- 1;
            }
            if(A1_fea == TRUE){
                fea_res[[i-1]][iter, 1] <- 1;
            }
            if(A2_fea == TRUE){
                fea_res[[i-1]][iter, 2] <- 1;
            }
            iter    <- iter - 1;
        }
        print(i);
    }
    all_res <- summarise_randmat(tot_res = tot_res, fea_res = fea_res);
    return(all_res);
}


species_interactions <- function(mat, type = 0){
    if(type == 1){
        mat[mat > 0] <- -1*mat[mat > 0];
    }
    if(type == 2){
        mat[mat < 0] <- -1*mat[mat < 0];
    }
    if(type == 3){
        for(i in 1:dim(mat)[1]){
            for(j in 1:dim(mat)[2]){
                if(mat[i, j] * mat[j, i] > 0){
                    mat[j, i] <- -1 * mat[j, i];
                }
            }
        }
    }
    return(mat);
}


summarise_randmat <- function(tot_res, fea_res){
    sims    <- length(tot_res);
    all_res <- matrix(data = 0, nrow = sims, ncol = 9);
    for(i in 1:sims){
        unstables <- tot_res[[i]][,1] == FALSE & tot_res[[i]][,2] == FALSE;
        stables   <- tot_res[[i]][,1] == TRUE  & tot_res[[i]][,2] == TRUE;
        unstabled <- tot_res[[i]][,1] == TRUE  & tot_res[[i]][,2] == FALSE;
        stabled   <- tot_res[[i]][,1] == FALSE & tot_res[[i]][,2] == TRUE;
        non_feas  <- fea_res[[i]][,1] == FALSE & fea_res[[i]][,2] == FALSE;
        feasibl   <- fea_res[[i]][,1] == TRUE  & fea_res[[i]][,2] == TRUE;
        unfeased  <- fea_res[[i]][,1] == TRUE  & fea_res[[i]][,2] == FALSE;
        feased    <- fea_res[[i]][,1] == FALSE & fea_res[[i]][,2] == TRUE;
        all_res[i, 1] <- i + 1;
        all_res[i, 2] <- sum(unstables);
        all_res[i, 3] <- sum(stables);
        all_res[i, 4] <- sum(unstabled);
        all_res[i, 5] <- sum(stabled);
        all_res[i, 6] <- sum(non_feas);
        all_res[i, 7] <- sum(feasibl);
        all_res[i, 8] <- sum(unfeased);
        all_res[i, 9] <- sum(feased);
    }
    return(all_res);
}

get_rand_eigs <- function(int_type = 0, iter = 1000){
    nn             <- 20;
    eigres         <- matrix(data = 0, ncol = 82, nrow = iter);
    eigres[,1]     <- int_type;
    while(iter > 0){
        r_vec     <- runif(n = nn, min = 1, max = 1000);
        A1_dat    <- rnorm(n = nn * nn, mean = 0, sd = 0.4);
        A1        <- matrix(data = A1_dat, nrow = nn, ncol = nn);
        A1        <- species_interactions(mat = A1, type = int_type);
        diag(A1)  <- -1;
        epsil     <- runif(n = nn, min = 1, max = 999);
        eps_dat   <- rep(x = epsil, times = nn);
        eps_mat   <- matrix(data = epsil, nrow = nn, ncol = nn, 
                            byrow = FALSE);
        avg_mat   <- matrix(data = mean(1:999), nrow = nn, ncol = nn, 
                            byrow = FALSE);
        A2        <- A1 * eps_mat;
        A1        <- A1 * avg_mat;
        mat1_e    <- eigen(A1)$values;
        mat2_e    <- eigen(A2)$values;
        real_mat1 <- Re(mat1_e);
        imag_mat1 <- Im(mat1_e);
        real_mat2 <- Re(mat2_e);
        imag_mat2 <- Im(mat2_e);
        stab1     <- max(real_mat1) < 0;
        stab2     <- max(real_mat2) < 0;
        if(stab1 == FALSE & stab2 == FALSE){
            eigres[iter,2] <- 1;
        }
        if(stab1 == TRUE & stab2 == TRUE){
            eigres[iter,2] <- 2;
        }
        if(stab1 == TRUE & stab2 == FALSE){
            eigres[iter,2] <- 3;
        }
        if(stab1 == FALSE & stab2 == TRUE){
            eigres[iter,2] <- 4;
        }
        eigres[iter,3:22]  <- real_mat1;
        eigres[iter,23:42] <- imag_mat1;
        eigres[iter,43:62] <- real_mat2;
        eigres[iter,63:82] <- imag_mat2;
        iter    <- iter - 1;
    }
    return(eigres);
}

plot_eig_set <- function(eigres){
    par(mfrow = c(2,2), mar = c(5, 5, 1, 1));
    x0 <- min(cbind(eigres[,3:22], eigres[,43:62]));
    x1 <- max(cbind(eigres[,3:22], eigres[,43:62]));
    plot(x = 0, y = 0, type = "n", xlim = c(x0, x1), ylim = c(-1500, 1500),
         xlab = "Real component", ylab = "Imaginary component", cex.lab = 1.25);
    abline(h = 0, lty = "dotted", lwd = 0.8);
    abline(v = 0, lty = "dotted", lwd = 0.8);
    if(1 %in% eigres[,2]){
        row <- which(eigres[,2] == 1)[1];
        m1r <- eigres[row,3:22];
        m1i <- eigres[row,23:42];
        m2r <- eigres[row,43:62];
        m2i <- eigres[row,63:82];
        points(x = m1r, y = m1i, pch = 20, cex = 1.5, col = "black");
        points(x = m2r, y = m2i, pch = 20, cex = 1.5, col = "red");
    }
    text(x = x0 + (x1 - x0)*0.2, y = 1500, "Unstable", cex = 1.5);
    plot(x = 0, y = 0, type = "n", xlim = c(x0, x1), ylim = c(-1500, 1500),
         xlab = "Real component", ylab = "Imaginary component", cex.lab = 1.25);
    abline(h = 0, lty = "dotted", lwd = 0.8);
    abline(v = 0, lty = "dotted", lwd = 0.8);
    if(2 %in% eigres[,2]){
        row <- which(eigres[,2] == 2)[1];
        m1r <- eigres[row,3:22];
        m1i <- eigres[row,23:42];
        m2r <- eigres[row,43:62];
        m2i <- eigres[row,63:82];
        points(x = m1r, y = m1i, pch = 20, cex = 1.5, col = "black");
        points(x = m2r, y = m2i, pch = 20, cex = 1.5, col = "red");
    }
    text(x = x0 + (x1 - x0)*0.2, y = 1500, "Stable", cex = 1.5);
    plot(x = 0, y = 0, type = "n", xlim = c(x0, x1), ylim = c(-1500, 1500),
         xlab = "Real component", ylab = "Imaginary component", cex.lab = 1.25);
    abline(h = 0, lty = "dotted", lwd = 0.8);
    abline(v = 0, lty = "dotted", lwd = 0.8);
    if(3 %in% eigres[,2]){
        row <- which(eigres[,2] == 3)[1];
        m1r <- eigres[row,3:22];
        m1i <- eigres[row,23:42];
        m2r <- eigres[row,43:62];
        m2i <- eigres[row,63:82];
        points(x = m1r, y = m1i, pch = 20, cex = 1.5, col = "black");
        points(x = m2r, y = m2i, pch = 20, cex = 1.5, col = "red");
    }
    text(x = x0 + (x1 - x0)*0.2, y = 1500, "Destabilised", cex = 1.5);
    plot(x = 0, y = 0, type = "n", xlim =c(x0, x1), ylim = c(-1500, 1500),
         xlab = "Real component", ylab = "Imaginary component", cex.lab = 1.25);
    abline(h = 0, lty = "dotted", lwd = 0.8);
    abline(v = 0, lty = "dotted", lwd = 0.8);
    if(4 %in% eigres[,2]){
        row <- which(eigres[,2] == 4)[1];
        m1r <- eigres[row,3:22];
        m1i <- eigres[row,23:42];
        m2r <- eigres[row,43:62];
        m2i <- eigres[row,63:82];
        points(x = m1r, y = m1i, pch = 20, cex = 1.5, col = "black");
        points(x = m2r, y = m2i, pch = 20, cex = 1.5, col = "red");
    }
    text(x = x0 + (x1 - x0)*0.2, y = 1500, "Stabilised", cex = 1.5);
}
```

```{r, echo = FALSE, fig.height = 10, fig.width = 10}
eres <- get_rand_eigs(int_type = 0, iter = 10000);
plot_eig_set(eres);
```

Below shows plots for competitive communities.

```{r, echo = FALSE, fig.height = 10, fig.width = 10}
eres <- get_rand_eigs(int_type = 1, iter = 10000);
plot_eig_set(eres);
```

Below shows plots for mutualist communities.

```{r, echo = FALSE, fig.height = 10, fig.width = 10}
eres <- get_rand_eigs(int_type = 2, iter = 10000);
plot_eig_set(eres);
```

Below shows plots for predator-prey communities.

```{r, echo = FALSE, fig.height = 10, fig.width = 10}
eres <- get_rand_eigs(int_type = 3, iter = 10000);
plot_eig_set(eres);
```

What I would like to explore is some sort of pattern in these points that links to the previous plot showing probability of stabilisation versus destabilisation of generation time, but I'm stuck for now. What I can do is look at stable versus feasible systems; the latter seem pretty much the same, except that real eigenvalues in feasible systems are all lower values. Below shows one example for a predator-prey community of $S = 20$.

```{r, echo = FALSE, fig.height = 6, fig.width = 10}
get_rand_feas <- function(int_type = 0, iter = 1000){
    nn             <- 20;
    eigres         <- matrix(data = 0, ncol = 42, nrow = iter);
    eigres[,1]     <- int_type;
    while(iter > 0){
        r_vec     <- runif(n = nn, min = 1, max = 10);
        A1_dat    <- rnorm(n = nn * nn, mean = 0, sd = 0.4);
        A1        <- matrix(data = A1_dat, nrow = nn, ncol = nn);
        A1        <- species_interactions(mat = A1, type = int_type);
        diag(A1)  <- -1;
        avg_mat   <- matrix(data = mean(1:999), nrow = nn, ncol = nn, 
                            byrow = FALSE);
        A1        <- A1 * avg_mat;
        mat1_e    <- eigen(A1)$values;
        real_mat1 <- Re(mat1_e);
        imag_mat1 <- Im(mat1_e);
        stab1     <- max(real_mat1) < 0;
        A1_fea    <- min(-1*solve(A1) %*% r_vec) > 0;
        if(stab1 == TRUE & A1_fea == FALSE){
            eigres[iter,2] <- 1;
        }
        if(stab1 == TRUE & A1_fea == TRUE){
            eigres[iter,2] <- 2;
        }
        eigres[iter,3:22]  <- real_mat1;
        eigres[iter,23:42] <- imag_mat1;
        iter    <- iter - 1;
    }
    return(eigres);
}


plot_feas_set <- function(eigres){
    par(mfrow = c(1,2), mar = c(5, 5, 1, 1));
    x0 <- min(eigres[,3:22]);
    x1 <- max(eigres[,3:22]);
    plot(x = 0, y = 0, type = "n", xlim = c(x0, x1), ylim = c(-1500, 1500),
         xlab = "Real component", ylab = "Imaginary component", cex.lab = 1.25);
    abline(h = 0, lty = "dotted", lwd = 0.8);
    abline(v = 0, lty = "dotted", lwd = 0.8);
    if(1 %in% eigres[,2]){
        row <- which(eigres[,2] == 1)[1];
        m1r <- eigres[row,3:22];
        m1i <- eigres[row,23:42];
        points(x = m1r, y = m1i, pch = 20, cex = 1.5, col = "black");
    }
    text(x = x0 + (x1 - x0)*0.2, y = 1500, "Stable", cex = 1.5);
    plot(x = 0, y = 0, type = "n", xlim = c(x0, x1), ylim = c(-1500, 1500),
         xlab = "Real component", ylab = "Imaginary component", cex.lab = 1.25);
    abline(h = 0, lty = "dotted", lwd = 0.8);
    abline(v = 0, lty = "dotted", lwd = 0.8);
    if(2 %in% eigres[,2]){
        row <- which(eigres[,2] == 2)[1];
        m1r <- eigres[row,3:22];
        m1i <- eigres[row,23:42];
        points(x = m1r, y = m1i, pch = 20, cex = 1.5, col = "black");
    }
    text(x = x0 + (x1 - x0)*0.2, y = 1500, "Feasible", cex = 1.5);
}
fea_test <- get_rand_feas(iter = 10000, int_type = 3);
plot_feas_set(fea_test)
```

I also looked at the matrices that decribe the *changes* between the community matrix with no variation in generation time ($A_{1}$) versus after the addition of generation time ($A_{2}$), which can be described by the transforming matrix ($B$), where,

$$A_{2} = A_{1}B$$
$$A_{1}^{t} A_{2} = A_{1}^{t} A_{1}B$$
$$(A^{t}_{1}A_{1})^{-1}A_{1}^{t} A_{2} = (A^{t}_{1}A_{1})^{-1}A_{1}^{t} A_{1}B$$

$$B = (A^{t}_{1}A_{1})^{-1}A_{1}^{t} A_{2}$$
The transforming matrix B does not appear to have any clear properties when $A_{2}$ stabilises versus destabilises -- its values appear the same, as do the eigenvalues after decomposition. Weird.

********************************************************************************

**AUTHOR'S NOTE:** This is an initial draft of a potential [brief communcation](https://www.nature.com/natecolevol/about/content) for *Nature Ecology and Evolution*. I think that the take-home message can be expressed in 1500 words. As far as I've been able to find, such an letter would be novel and interesting. The most likely group that would have discovered this already would be the [Allesina lab](https://allesinalab.uchicago.edu/), which works a lot with random matrices, but I've not seen anything about generation time variation published by them. In developing this theory, I also came up with some brief comments on [the effect of increasing numbers of evolutionary traits on eco-evolutionary stability.](#comment_on_Patel), making the simple point after reading @Patel2018 that ecological systems are increasingly likely to be destablised, and unstable ecological systems are decreasingly likely to be stabilised, at higher numbers of evolving species traits.

For the final paper, I am strongly considering changing the simulations a bit to consider 3-5 scenarios. This isn't going to change anything about the general conclusions, I don't think. What it will do is make the simulations more consistent with what others have tried in the past:

1. Random network but with elements drawn from a normal distribution with N(0, 0.4) and the diagonal elements of the matrix being forced at -1 (helping out stability a bit -- since in all stable matrices, diagonal elements must be negative).
2. Competitive network with elements drawn from N(0, 0.4) and diagonals at -1, but when sampling form the normal distribution returns positive values, the sign is reversed so all values are negative.
3. Mutualist network created as above, but with all signs forced to be positive (again, except the diagonal).
4. Predator-prey network created as above, but forcing the sign of a_ij to be the opposite of a_ji.

If the below conclusions hold for all of the above, then I think the results can be made even stronger. The best to present would probably be 1, with 2-4 mentioned and then shown in the supporting information. It also would be useful to look at feasibility criteria established by @Dougoud2018, who very recently made the point that some of May and Allesina's criteria allows for negative species densities when stable. Feasibility criteria are as follows,

$$x^{*} = -\left(\theta I + (CS)^{-\delta}A\right)^{-1}r.$$
The above is not nearly as nasty as it looks, especially because it is entirely reasonable to simply use convenient values to parameterise it. The variable $x^{*}$ is just the vector of species abundances at equilibrium (we need all of them to be positive). The matrix $I$ is just the identity matrix (1s on the diagonal, 0s on the off-diagonal elements), and the value $\theta$ is just the strength of intraspecific competition -- we can just set this to $\theta = -1$ (as others have). The variable $C$ is just the connectance of the community, which we will also set to 1 for convenience (lower values would mean that some species don't interact with one another, corresponding to an off-diagonal matrix element of 0). And $\delta$ just affects the strength of interactions -- which we can set to $\delta = 0$ for strong interactions. Hence, the whole $(CS)^{-\delta} = 1$, so we're just adding the diagonal matrix of -1s ($\theta I$) to $A$, which has a diagonal of all zeros and an off diagonal effecting species interactions,

$$x^{*} = -\left(\theta I + A\right)^{-1}r.$$

To check the feasibility criteria, all that needs to be done is to invert $(\theta I + A)$ and multiply the matrix by the vector of growth rates $r$, which we can also just set to 1. So really, we're just multiplying $-(\theta I + A)$ by a vector of ones and checking to make sure that all the values are positive. This isn't much extra work, but it will probably go a long way toward satisfying any reviewers familiar with @Dougoud2018.

********************************************************************************

<a name = "working_draft">Variation in generation time drives stability in large random communities</a>
================================================================================

```{r, echo = FALSE}
library(knitr);
dat  <- read.table(file = "mat_dat.csv", header = TRUE, sep = ",");
dat  <- cbind(dat, (dat[,3] - dat[,5]) + dat[,4]);
rownames(dat) <- NULL;
colnames(dat) <- c("Species (S)", "Unstable", "Stable", "Stabilised", 
                   "Destabilised", "Stable ($\\ Var(\u03b3)$ )")
```

********************************************************************************

**Analyses of dynamic systems using random matrices find that stability generally decreases with increasing system size. But in ecological communities, the rate that species densities change as a consequence of species interactions will depend on relative species generation times. Here we show that variation in generation time becomes increasingly important for community stabilisation with increasing community size, and is therefore a potentially key contributor to the stability of large ecosystems.**

********************************************************************************

Understanding the stability and therefore persistence of species rich ecological communities in nature remains a long-standing puzzle in ecology [@Hutchinson1961; @May1972; @Allesina2012; @Grilli2017]. The general conditions under which such communities return to equilibrium densities when perturbed (i.e., are stabilised) are well-established, as is the knowledge that stabilisation becomes increasingly unlikely as community size increases [@May1972]. Recently, analyses of random communities have investigated the effects of community structure, finding, e.g., that predator-prey interactions [@Allesina2012], increasing numbers of species interaction partners [@Allesina2015], correlations between interaction strengths [@Tang2014a], and higher order species interactions can be stabilising [@Allesina2011; @Levine2017]. These investigations assume that the rates at which interacting species affect one another are uniform. But generation times can vary by orders of magnitude between interacting species, causing response time in species dynamics to vary following perturbation. We find that this variation becomes increasingly more likely to stabilise rather than destabilise simulated communities as species number ($S$) increases, and that the probability that community stability is solely caused by variation in generation time is near unity for randomly assembled communities of $S > 10$.

In communities of interacting species, the density of any species $j$ ($N_{j}$) can affect species $i$'s mean fitness ($W_{i}$), and therefore its population growth rate [$N_{i}W_{i}$; @Patel2018]. But the time scale on which species $i$'s growth rate changes ($\gamma_{i}$) in response to the density of another species will vary depending on species $i$'s life history. Short-lived species can experience tens to hundreds of generations during the same time scale that long-lived species experience a single generation. Such timescale differences can have profound consequences for ecological system dynamics [@Hastings2004]. In ecological communities, species with short generation times can be expected to respond more quickly to changes in species densities (higher $\gamma_{i}$), while species with long generation times will respond consistently more slowly (lower $\gamma_{i}$). The relative speed at which the growth rate of species $i$ is affected by a change in the density species of $j$ can therefore be modulated by $\gamma_{i}$ and expressed as $\gamma_{i} \times \partial N_{i}W_{i}/\partial N_{j}$. For large communities, it is convenient to represent these interactions for all $i$ and $j$ pairs using a Jacobian matrix,

$$\boldsymbol{A} = \begin{bmatrix}
    \gamma_{i}\frac{\partial N_{i}W_{i}}{\partial N_{i}}  & \cdots & \gamma_{i}\frac{\partial N_{i}W_{i}}{\partial N_{S}}  \\
    \vdots & \ddots & \vdots \\
    \gamma_{S} \frac{\partial N_{S}W_{S}}{\partial N_{i}}  & \cdots & \gamma_{S} \frac{\partial N_{S}W_{S}}{\partial N_{S}}  \\
\end{bmatrix}.$$

A community is stable if the real components of all eigenvalues of $\boldsymbol{A}$ are negative. 

We examined the stability of 100 million random communities in which $S$ ranged between 2-15 before and after the addition of variation in $\gamma_{i}$. Elements of $\boldsymbol{A}$ were selected from a random uniform distribution $\mathcal{U}\left(-4, 4\right)$, and variation in $\gamma_{i}$ was generated with a random uniform distribution such that $\gamma_{i} = \mathcal{U}\left(1, 1000\right)$ (see [Supporting Information S1](#SI_1)). For simplicity, we assumed complete connectance of simulated communities (i.e., elements of $\boldsymbol{A}$ were allowed to be nonzero with a probability of $C = 1$), but this did not effect our general conclusions. Random communities were categorised in one of four ways (Table 1): (1) Unstable before and after the addition of variance in $\gamma_{i}$ (unstable), (2) stable before and after the addition of variance in $\gamma_{i}$ (stable), (3) unstable before but not after the addition of variation in $\gamma_{i}$ (stabilised), and (4) stable before but not after the addition of variation in $\gamma_{i}$ (destabilised; Table 1).

We found that as $S$ increases, so does the effect of variation in $\gamma_{i}$ on increasing system stability (Figure 1). At high $S$, nearly all stable communities were only stable due to the effect of variation in $\gamma_{i}$, which rarely destabilised species rich communities ([Supporting Information S1](#SI_2)). All else being equal, variation in generation time therefore becomes more influential in stabilising random communities as community size increases, meaning that variation in generation time might be an important contributor to stability in large communities. 

More broadly, individual processes within complex dynamic systems might respond relatively slowly or quickly to perturbations in the system. We show that accounting for this variation becomes more important with increasing system size. 



**References**

<div id="refs"></div>

********************************************************************************

<a name = "old_tab_1">**Table 1:**</a> Stability results from 100 million simulations of random interaction matrices for 2-15 species ($S$). Columns 2 and 3 report the number of stable and unstable communities in the absence of variation in species generation time (all $\gamma = 1$). Columns 4 and 5 report the number of unstable communities stabilised or stable communities destabilised by $Var(\gamma)$, respectively. Column 6 reports the total number of communities that are stable given $Var(\gamma)$ (compare to column 3).

```{r, echo = FALSE, caption = "Stability results from 100 million simulations of random interaction matrices for 2-15 species (S). Columns 2 and 3 report the number of stable and unstable communities in the absence of variation in species generation time (all $\\u03b3 = 1$). Columns 4 and 5 report the number of unstable communities stabilised or stable communities destabilised by $\\ Var(\u03b3)$, respectively. Column 6 reports the total number of communities that are stable given $\\ Var(\u03b3)$ (compare to column 3)."}
kable(dat);
```

********************************************************************************

<a name = "old_fig_1">**Figure 1:**</a> Stability of random communities when generation time ($\gamma$) varies and when it does not for 2-15 species (x-axis). Bars compare the $\ln$ total number of communities found to be stable out of 100 million before (dark grey) and after (light grey) $Var(\gamma)$ is added to a community (left y-axis). Points show the proportion of these random communities in which stability is a direct consequence of $Var(\gamma)$. 

```{r, echo = FALSE}
bar_dat                      <- t(cbind(dat[,3], dat[,6]));
log_bar_dat                  <- log(bar_dat);
log_bar_dat[log_bar_dat < 0] <- 0;
par(oma = c(4, 4, 1, 4), mar = c(0.5, 0.5, 0.5, 0.5), lwd = 1);
barplot(log_bar_dat, beside = TRUE, col = c("grey60", "grey80"),
        names.arg = dat[,1], ylim = c(0, 25), xlab = "Species number (S)",
        ylab = "Ln number of stable communities", cex.lab = 1.25, 
        cex.axis = 1.25, xlim = c(1, 42), cex.names = 1);
legend("topleft", c("\u03b3 = 1", "\u03b3 = [1, 1000]"), pch=15, 
       col=c("grey60","grey80"), cex = 1.5);
box(lwd = 2);
par(new = TRUE);
y1     <- dat[,4] / (dat[,3] + dat[,4]);
x1     <- seq(from = 2.315, length = 14, by = 0.95)
plot(x = x1, y = y1, xaxt = "n", yaxt = "n", lwd = 2, ylim = c(0, 1),
     xlab = "", ylab = "", type = "b", xlim = c(2, 15), pch = 20, cex = 1.25);
axis(side = 4, at = seq(from = 0, to = 1, by = 0.2), cex.axis = 1.25);
mtext(expression(paste("Species number (S)")), outer = TRUE, side = 1,
      line = 2, cex = 1.25);
mtext(expression(paste("Ln number of stable communities")), outer = TRUE, 
      side = 2, line = 2, cex = 1.25);
mtext(expression(paste("Pr. stable due to Var(",gamma,")")), outer = TRUE, 
      side = 4, line = 2.2, cex = 1.25);
```

********************************************************************************

<a name="gen_time_stability">Variation in generation time drives stability in large random communities: Supporting Information S1</a>
--------------------------------------------------------------------------------

********************************************************************************

1. [**Effect of different variation in $\gamma$**](#SI_1)
2. [**Destabilisation with increasing $S$**](#SI_2)
3. [**Code underlying random matrix simulation**](#SI_3)

********************************************************************************

<a name="SI_1">**Effect of different variation in $\gamma$**</a>

Below shows how the amount of variation in generation time (range of $\gamma_{i}$) in a community affects stability. Random communities of $S=8$ species are simulated 1 million times across different magnitudes of variance in $\gamma_{i}$. Random values of $\gamma_{i}$ are chosen for each species $i$ from a uniform distribution $\mathcal{U}\left(1, \max(\gamma_{i})\right)$, where $\max(\gamma_{i})$ ranges from 1 to 100000.

```{r, echo = FALSE, eval = FALSE}
res  <- NULL;
mags <- 10^(0:5);
for(i in mags){
    nn     <- 8;
    A1_stt <- 0;
    A2_stt <- 0;
    iter   <- 10000000;
    while(iter > 0){
        A1_dat  <- runif(n = nn * nn, min = -4, max = 4);
        A1      <- matrix(data = A1_dat, nrow = nn, ncol = nn);
        A2_dat  <- runif(n = nn * nn, min = -4, max = 4);
        A2      <- matrix(data = A2_dat, nrow = nn, ncol = nn);
        gamval  <- runif(n = nn, min = 1, max = i);
        gam_dat <- rep(x = gamval, times = nn);
        gam_mat <- matrix(data = gam_dat, nrow = nn, ncol = nn, byrow = FALSE);
        A2      <- A2 * gam_mat;
        A1_stb  <- max(Re(eigen(A1)$values)) < 0;
        A2_stb  <- max(Re(eigen(A2)$values)) < 0;
        if(A1_stb == TRUE){
          A1_stt <- A1_stt + 1;
        }
        if(A2_stb == TRUE){
          A2_stt <- A2_stt + 1;
        }
        iter    <- iter - 1;
    }
    res <- rbind(res, c(A1_stt, A2_stt));
    print(i);
}
```
```{r, echo = FALSE, eval = TRUE}
mag_var <- read.table(file = "var_gen_mag.csv", header = TRUE, sep = ",");
stabi_3 <- mag_var[,3] / 10000000;
par(mar = c(5, 5, 2, 1));
plot(x = log10(mag_var[,1]), y = stabi_3, type = "b", lwd = 2, ylim = c(0, 0.0005),
     xlab = expression(paste("LOG max(",gamma[i],")")), ylab = "Proportion stable",
     cex.axis = 1.5, cex.lab = 1.5, lty = "solid");
```

Figure S1-1: The proportion of random $S=8$ communities that are stable as $\max(\gamma_{i})$ increases over 5 orders of magnitude. Each point represents a proportion calculated from 1 million random simulated matrices.


Once the generation time varies by an order of magnitude of around 1000, there is little increase in terms of stability. Magnitudes higher than $\gamma_{i} = 1000$ are also likely to be biologically unrealistic for most communities.

********************************************************************************

<a name="SI_2">**Destabilisation with increasing $S$**</a>

Here we use the data from Table 1 in the main text to show that the proportion of already stable communities that are destabilised by the addition of variance in $\gamma_{i}$ decreases with increasing $S$.

```{r, echo = FALSE, eval = TRUE}
par(mar = c(5, 5, 2, 1));
y1 <- dat[,5] / (dat[,2] + dat[,5]);
plot(x = dat[,1], y = y1, type = "b", lwd = 2, ylim = c(0, 0.02),
     xlab = "Species number (S)", 
     ylab = expression(paste("Pr. unstable due to Var(",gamma,")")),
     cex.axis = 1.5, cex.lab = 1.5, lty = "solid");
```

Unstable communities are rarely unstable due to variation in generation time, and as the number of species increases, the probability that unstability will be caused by such variation becomes vanishingly small. Hence, for large communities, variation in generation time might be critical for community stability.

**OLD STUFF**

I'm adding some stuff from [earlier](https://raw.githubusercontent.com/bradduthie/random_matrix_stability/e1314dfc13353aa301f34782827c092b0c5c7b52/random_matrix_stability.Rmd?token=AFSzia2ycJ9XXiZYYMrWG9PrWVHCXRheks5a03EvwA%3D%3D) back in now, as it might be used in the writing again. Note that the language underlying all of this needs to be adjusted to be about complex systems more generally.

********************************************************************************

**Analyses of dynamic systems using random matrices find that stability generally decreases with increasing system size. But in ecological communities, the rate that species densities change as a consequence of species interactions will depend on relative species generation times. Densities of species with relatively short generation times will change more rapidly than densities of species with longer generation times. Interaction effects are therefore expected to be correlated within species, with some species densities changing more rapidly than others in a community. Here we show that by accounting for variation in generation time among species, community stability is substantially increased. Further, the influence of variation in generation time becomes exponentially more important as community size increases. We suggest that variation in species generation time might be a key contributor to stability of large ecological communities.**

********************************************************************************

Species generation time varies by orders of magnitude within communities, potentially affecting the rate at which the density of one species affects the population growth rate of another. Yet I've not been able to find anything on this in the literature in a random matrix context (or any other context). I want to **determine if the effects of varying generation time among community members is stabilising or destabilising in an ecological system**. This work is partly inspired by the use of $\varepsilon$ by @Patel2018 to separate the time scale of ecological versus evolutionary dynamics, and partly inspired by @Jirsa2004 to separate generation time of different species in a community.

Here I will consider a Jacobian matrix of interacting species $\boldsymbol{A}$ and focus on the stability of ecological interactions given variation in generation time. I will use the same technique of @Patel2018 for varying ecological and evolutionary time scales, but a bit differently. I assume that the effect that the density of any species $j$ ($N_{j}$) has on the growth rate of a focal species $i$ ($\partial N_{i}W_{i}/\partial N_{j}$) is consistently affected by a value $\gamma_{i}$ (I am using $\gamma_{i}$ instead of $\varepsilon_{i}$ to avoid confusing generation time variance with ecological versus evolutionary rate difference). Higher values of $\gamma_{i}$ correspond to shorter absolute generation times and lower values correspond to longer generation times. The matrix below $\boldsymbol{A}$ describes the dynamics for two species $i$ and $j$ with effects of generation times $\gamma_{i}$ and $\gamma_{j}$, respectively.

$$\boldsymbol{A} = \begin{bmatrix}
    \gamma_{i}\frac{\partial N_{i}W_{i}}{\partial N_{i}}  & \gamma_{i}\frac{\partial N_{i}W_{i}}{\partial N_{j}}  \\
    \gamma_{j} \frac{\partial N_{j}W_{j}}{\partial N_{i}}  & \gamma_{j} \frac{\partial N_{j}W_{j}}{\partial N_{j}}  \\
\end{bmatrix}.$$

I will investigate **how the amount of variation in generation time (range of $\gamma$) in a community affects stability**.

********************************************************************************

<a name="SI_3">**Code underlying random matrix simulation**</a>


```{r}
# Will add code here.
# For consistency with Dougoud, maybe run some simulations under their parameter
# values:
# C = 1, elements = N(0, 0.4), and theta = -1 (diag).
# Can then force competitive (folded normal to all negative values), or
# mutualistic networks -- alongside the random ones. Could do a predator-prey
# one as well forcing matrix signs to differ.
```


********************************************************************************