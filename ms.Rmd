---
title: "Component response rate variation drives stability in large complex systems"
author: "Brad Duthie"
bibliography: references.bib
output:
  html_document: default
  pdf_document:
    fig_caption: yes
  word_document:
    fig_caption: yes
    pandoc_args:
    - --csl
    - evolution.csl
    reference_docx: docx_template.docx
header-includes:
- \usepackage{amsmath}
- \usepackage{natbib}
- \usepackage{lineno}
- \usepackage[utf8]{inputenc}
- \linenumbers
- \bibliographystyle{amnatnat}
linestretch: 1
link-citations: yes
linkcolor: blue
csl: nature.csl
biblio-style: apalike
---

```{r, echo = FALSE}
source(file = "R/sim_mat.R");
source(file = "R/plot_figs.R");
```

********************************************************************************

**The stability of a complex system generally decreases with increasing system size, as is demonstrated by random matrix theory [@May1972; @Allesina2012]. This counter-intuitive result, first shown by May [@May1972], is broadly relevant for understanding the dynamics and persistence of systems such as chemical, biological, and social networks. Much attention has especially been given to the stability of ecological communities such as food webs or mutualist networks, with recent work investigating how different community structures affect stability [@Haldane2011; @Allesina2012; @Mougi2012; @Allesina2015a; @Gao2016; @Grilli2017; @Patel2018]. But more broadly, stabilising mechanisms in complex systems remain under-developed, and the effect of variation in the response rate of individual system components remains unexplored. Here I show that when components of a complex system respond to system dynamics at different rates, system stability is markedly increased. This increase in stability is especially strong when variation in component response rate ($\gamma$) is high and has a skewed distribution. Further, these effects become increasingly important as system size increases, to the extent that the largest stable complex systems would otherwise be unstable if not for variation in $\gamma$. My results therefore reveal a previously unconsidered driver of system stability that is likely to be pervasive across all complex systems. Future research in complex systems should therefore account for the varying response rates of individual system components when assessing whole system stability.** 

<!---

@Koch1999 Suggests that the results of @May1972 can apply to neuroscience

@May2008 Suggests that random matrix theory can apply to banking
--->

<!---

2. Go back to @May1972 and note how the original ecological result has been broadened for systems such as evolutionary networks, gene regulatory networks, economics, etc. (references needed). Perhaps make the broader point that even local systems have different elements of different types of systems. 
3. Briefly point out the advances that have been made in terms of network structures (e.g., random versus competitive interactions), but then hit the point that different components of complex systems are expected to respond on different time scales [e.g. @Patel2018], and no one has looked at how this might affect stability of systems more broadly. The current paper is going to show that variation in component response rate increases stability.
4. A paragraph with some broad explanation of the idea of matrix stability, along the lines of @Allesina2012. This will effectively explain the idea of random matrix theory to the reader.
5. A paragraph introducing, mathematically, how I am adding varying rates of component response -- multipling each row $i$ by a scalar $\gamma_{i}$. First this will be done with some simple function giving $Var(\gamma_{i})$, then in a more structured way such that random components that are more likely to be positively influenced by other components having faster or slower rates (higher or lower $\gamma_{i}$) of response. A sentence or two is needed to suggest what this might mean biologically (e.g., generalist predators have longer generation times than their prey). 
6. A paragraph explaining the results of the random matrices, with brief mention of other types of systems (e.g., predator-prey, mutualist, competitor) presented in supporting information. The obvious increase in stability with different variation of $\gamma_{i}$ will be presented, along with an intuitive explanation of why this is the case (still waiting on simulations -- it would be great if correlation between positive or negative processes and response times led to increased stability, as appears to be the case. I could then argue that $Var(\gamma_{i})$ has a minimum such correlation of zero, and can only increase in stabilisation by having an absolute value of correlation being greater than zero). At least two [key figures](#fig_ideas) will be included, likely with four panels (1. without variation, 2. with unstructured variation, and 3. and 4. with structured variation).
7. Some sort of mention is needed for a couple odd results; first, that in mutualist networks, stability is not affected -- perhaps because of the lack of variance in component response rate given number of interaction types (note, I think, competitive networks can have indirect positives due to intransitive effects). Second, *feasibility* is not increased, so pure ecological networks might not be affected by this (but emphasise that *pure* ecological networks don't really exist in nature -- they are incorporated into evolutionary, economic, social, systems).
8. Some bold statement is needed here -- something to the effect of the argument that nearly all large stable complex systems will be stable *due to* the variation simulated in this paper. The odds that it would be stable without such variation becomes vanishingly small as system size increases.

--->


********************************************************************************

**References**

<div id="refs"></div>

********************************************************************************

**Figure 1: Distributions of component response rate ($\boldsymbol{\gamma}$) values in complex systems.** The stabilities of simulated complex systems with these $\gamma$ distributions are compared to otherwise identical complex systems with a fixed component response rate of $\gamma = 1$ across different system sizes ($S$; i.e., component numbers) given a unit $\gamma$ standard deviation ($\sigma_{\gamma} = 1$). Distributions are as follows: (a) uniform, (b) exponential, (c) beta ($\alpha = 0.5$ and $\beta = 0.5$), and (d) gamma ($k = 2$ and $\theta = 2$). Each panel shows 1 million randomly generated $\gamma$ values.

```{r, eval = TRUE, echo = FALSE, fig.height = 8}
show_gammas();
```

********************************************************************************

```{r, eval = TRUE, echo = FALSE}
eig_cloud <- eigen_cloud(sp = 20, iters = 10000);
Pr_D0     <- sum(eig_cloud$d0[,1] < 0) / length(eig_cloud$d0[,1]);
Pr_D1     <- sum(eig_cloud$d1[,1] < 0) / length(eig_cloud$d1[,1]);
Pr_D2     <- sum(eig_cloud$d2[,1] < 0) / length(eig_cloud$d2[,1]);
Pr_D3     <- sum(eig_cloud$d3[,1] < 0) / length(eig_cloud$d3[,1]);
Pr_D4     <- sum(eig_cloud$d4[,1] < 0) / length(eig_cloud$d4[,1]);
```

**Figure 2: Distributions of eigenvalues across different distributions of component response rate  ($\boldsymbol{\gamma}$) values.** Panels show 100000 random communities for $S = 20$ and $C = 1$, where off-diagonal elements are randomly sampled from a standard normal distribution $N(0, 1)$, diagonal elements are $-1$, and each row of elements is multiplied by a random scalar value $\gamma$ sampled from one of four distributions (black points in all sub-panels):  **a**, uniform $\Pr(\gamma = x) = 1/\sqrt{12}$ where $x \in [0, \sqrt{12}]$. **b**, exponential $\Pr(\gamma = x) = e^{-x}$ where $x \geq 0$. **c**, beta $\Pr(\gamma = x) = \frac{x^{\alpha - 1}(1-x)^{\beta - 1}}{B(\alpha, \beta)}$ where $x \in [0, 1]$, and where $B(\alpha, \beta) = \frac{\Gamma(\alpha)\Gamma(\beta)}{\Gamma(\alpha + \beta)}$ for $\alpha = 0.5$ and $\beta = 0.5$. **d**, gamma $\Pr(\gamma = x) = \frac{1}{\Gamma(k)\theta^{k}}x^{k-1}e^{\frac{-x}{\theta}}$ for $k = 2$ and $\theta = 2$, where $x \in [0, 1]$. Eigenvalues associated with each $\gamma$ distribution are compared with otherwise identical communities in which $\gamma = 1$ (pink points in all sub-panels). In all distributions, $SD(\gamma) = 1$; note that $\gamma$ distributions cannot be mean standardised without changing the sign of some community matrix elements, but the sign of eigenvalues (and therefore community stability) is unaffected by multiplying elements by any scalar value. Proportions of real components of eigenvalues (x-axis) below 0 are (a) `r Pr_D1`, (b) `r Pr_D2`, (c) `r Pr_D3`, (d) `r Pr_D4`, as compared to `r Pr_D0` when $\gamma = 1$.

```{r, eval = TRUE, echo = FALSE, fig.height = 8}
eig_plot(ecl = eig_cloud);
```

********************************************************************************

**Figure 3: Stability of large complex systems with and without variation in component response rate ($\boldsymbol{\gamma}$).** Panels show the $\ln$ number of systems that are stable across different system sizes ($S$) given $C = 1$, and the proportion of systems in which variation in $\gamma$ is critical for system stability. For each $S$, 1 million complex systems are randomly generated and tested for stability before and after variation in $\gamma$ is included at four different distributions: **a**, uniform, **b**, exponential, **c**, beta, and **d**, gamma. Red and black bars show the number of stable systems in the absence and presence of variance in $\gamma$, respectively. Blue lines show the proportion of systems that are stable when $Var(\gamma) > 0$, but would be unstable if $Var(\gamma) = 0$.

```{r, eval = TRUE, echo = FALSE, fig.height = 8}
dat <- read.csv(file = "sim_results/C_1/random_all.csv");
stable_N_plot(dat);
```






















